{
  "info": {
    "name": "Event Booking App - Tickets API",
    "schema": "https://schema.getpostman.com/json/collection/v2.1.0/collection.json",
    "_postman_id": "7bbf1b2a-1a4f-4d0a-bf5e-6b3f9f7a9a00"
  },
  "variable": [
    { "key": "base_url", "value": "http://localhost:8081" },
    { "key": "keycloak_url", "value": "http://localhost:9090" },
    { "key": "realm", "value": "event-ticket-platform" },
    { "key": "client_id", "value": "" },
    { "key": "username", "value": "" },
    { "key": "password", "value": "" },
    { "key": "access_token", "value": "" },
    { "key": "event_id", "value": "" },
    { "key": "ticket_type_id", "value": "" },
    { "key": "ticket_id", "value": "" }
  ],
  "item": [
    {
      "name": "Auth",
      "item": [
        {
          "name": "Get Access Token",
          "request": {
            "method": "POST",
            "header": [
              { "key": "Content-Type", "value": "application/x-www-form-urlencoded" }
            ],
            "url": {
              "raw": "{{keycloak_url}}/realms/{{realm}}/protocol/openid-connect/token",
              "host": ["{{keycloak_url}}"],
              "path": ["realms", "{{realm}}", "protocol", "openid-connect", "token"]
            },
            "body": {
              "mode": "urlencoded",
              "urlencoded": [
                { "key": "grant_type", "value": "password" },
                { "key": "client_id", "value": "{{client_id}}" },
                { "key": "username", "value": "{{username}}" },
                { "key": "password", "value": "{{password}}" },
                { "key": "scope", "value": "openid profile email" }
              ]
            }
          },
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "if (pm.response.code === 200) {",
                  "  const data = pm.response.json();",
                  "  pm.collectionVariables.set('access_token', data.access_token);",
                  "  pm.collectionVariables.set('token_expiry', Date.now() + (data.expires_in * 1000));",
                  "  pm.test('Access token obtained', function(){ pm.expect(data.access_token).to.exist; });",
                  "} else { pm.test('Failed to get token', function(){ pm.expect.fail('Token request failed'); }); }"
                ],
                "type": "text/javascript"
              }
            }
          ]
        }
      ]
    },
    {
      "name": "Events (Organizer)",
      "item": [
        {
          "name": "Create Event",
          "request": {
            "method": "POST",
            "header": [
              { "key": "Content-Type", "value": "application/json" },
              { "key": "Authorization", "value": "Bearer {{access_token}}" }
            ],
            "url": { "raw": "{{base_url}}/api/v1/events", "host": ["{{base_url}}"], "path": ["api","v1","events"] },
            "body": {
              "mode": "raw",
              "raw": "{\n  \"name\": \"Tech Conference 2025\",\n  \"start\": \"2025-12-15T09:00:00\",\n  \"end\": \"2025-12-15T18:00:00\",\n  \"venue\": \"Convention Center\",\n  \"salesStart\": \"2025-11-01T00:00:00\",\n  \"salesEnd\": \"2025-12-14T23:59:59\",\n  \"status\": \"PUBLISHED\",\n  \"ticketTypes\": [ { \"name\": \"Early Bird\", \"price\": 199.99, \"description\": \"Discounted\", \"totalAvailable\": 100 } ]\n}"
            }
          },
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "const res = pm.response.json();",
                  "if (res && res.id) { pm.collectionVariables.set('event_id', res.id); }",
                  "if (res && res.ticketTypes && res.ticketTypes.length) { pm.collectionVariables.set('ticket_type_id', res.ticketTypes[0].id); }",
                  "pm.test('Created', function(){ pm.expect(pm.response.code).to.eql(201); });"
                ],
                "type": "text/javascript"
              }
            }
          ]
        },
        {
          "name": "Update Event",
          "request": {
            "method": "PUT",
            "header": [ { "key": "Content-Type", "value": "application/json" }, { "key": "Authorization", "value": "Bearer {{access_token}}" } ],
            "url": { "raw": "{{base_url}}/api/v1/events/{{event_id}}", "host": ["{{base_url}}"], "path": ["api","v1","events","{{event_id}}"] },
            "body": { "mode": "raw", "raw": "{\n  \"id\": \"{{event_id}}\",\n  \"name\": \"Tech Conference 2025 - Updated\",\n  \"start\": \"2025-12-15T10:00:00\",\n  \"end\": \"2025-12-15T19:00:00\",\n  \"venue\": \"Main Hall\",\n  \"salesStart\": \"2025-11-01T00:00:00\",\n  \"salesEnd\": \"2025-12-14T23:59:59\",\n  \"status\": \"PUBLISHED\",\n  \"ticketTypes\": [ { \"id\": \"{{ticket_type_id}}\", \"name\": \"Regular\", \"price\": 299.99, \"description\": \"Standard\", \"totalAvailable\": 400 } ]\n}" }
          }
        },
        {
          "name": "List Events",
          "request": {
            "method": "GET",
            "header": [ { "key": "Authorization", "value": "Bearer {{access_token}}" } ],
            "url": { "raw": "{{base_url}}/api/v1/events?page=0&size=20&sort=start,desc", "host": ["{{base_url}}"], "path": ["api","v1","events"], "query": [ {"key":"page","value":"0"},{"key":"size","value":"20"},{"key":"sort","value":"start,desc"} ] }
          }
        },
        {
          "name": "Get Event",
          "request": {
            "method": "GET",
            "header": [ { "key": "Authorization", "value": "Bearer {{access_token}}" } ],
            "url": { "raw": "{{base_url}}/api/v1/events/{{event_id}}", "host": ["{{base_url}}"], "path": ["api","v1","events","{{event_id}}"] }
          }
        },
        {
          "name": "Delete Event",
          "request": {
            "method": "DELETE",
            "header": [ { "key": "Authorization", "value": "Bearer {{access_token}}" } ],
            "url": { "raw": "{{base_url}}/api/v1/events/{{event_id}}", "host": ["{{base_url}}"], "path": ["api","v1","events","{{event_id}}"] }
          }
        }
      ]
    },
    {
      "name": "Published Events",
      "item": [
        {
          "name": "List Published Events",
          "request": {
            "method": "GET",
            "header": [ { "key": "Authorization", "value": "Bearer {{access_token}}" } ],
            "url": { "raw": "{{base_url}}/api/v1/published-events?q=tech&page=0&size=20&sort=start,asc", "host": ["{{base_url}}"], "path": ["api","v1","published-events"], "query": [ {"key":"q","value":"tech"},{"key":"page","value":"0"},{"key":"size","value":"20"},{"key":"sort","value":"start,asc"} ] }
          }
        },
        {
          "name": "Get Published Event",
          "request": {
            "method": "GET",
            "header": [ { "key": "Authorization", "value": "Bearer {{access_token}}" } ],
            "url": { "raw": "{{base_url}}/api/v1/published-events/{{event_id}}", "host": ["{{base_url}}"], "path": ["api","v1","published-events","{{event_id}}"] }
          }
        }
      ]
    },
    {
      "name": "Tickets",
      "item": [
        {
          "name": "Purchase Ticket",
          "request": {
            "method": "POST",
            "header": [ { "key": "Authorization", "value": "Bearer {{access_token}}" } ],
            "url": { "raw": "{{base_url}}/api/v1/events/{{event_id}}/ticket-types/{{ticket_type_id}}/tickets", "host": ["{{base_url}}"], "path": ["api","v1","events","{{event_id}}","ticket-types","{{ticket_type_id}}","tickets"] }
          },
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test('No Content', function(){ pm.expect(pm.response.code).to.eql(204); });"
                ],
                "type": "text/javascript"
              }
            }
          ]
        },
        {
          "name": "List My Tickets",
          "request": {
            "method": "GET",
            "header": [ { "key": "Authorization", "value": "Bearer {{access_token}}" } ],
            "url": { "raw": "{{base_url}}/api/v1/tickets?page=0&size=20&sort=id,desc", "host": ["{{base_url}}"], "path": ["api","v1","tickets"], "query": [ {"key":"page","value":"0"},{"key":"size","value":"20"},{"key":"sort","value":"id,desc"} ] }
          },
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "const page = pm.response.json();",
                  "if (page && page.content && page.content.length) { pm.collectionVariables.set('ticket_id', page.content[0].id); }",
                  "pm.test('OK', function(){ pm.expect(pm.response.code).to.eql(200); });"
                ],
                "type": "text/javascript"
              }
            }
          ]
        },
        {
          "name": "Get Ticket",
          "request": {
            "method": "GET",
            "header": [ { "key": "Authorization", "value": "Bearer {{access_token}}" } ],
            "url": { "raw": "{{base_url}}/api/v1/tickets/{{ticket_id}}", "host": ["{{base_url}}"], "path": ["api","v1","tickets","{{ticket_id}}"] }
          }
        },
        {
          "name": "Get Ticket QR Code (PNG)",
          "request": {
            "method": "GET",
            "header": [ { "key": "Authorization", "value": "Bearer {{access_token}}" } ],
            "url": { "raw": "{{base_url}}/api/v1/tickets/{{ticket_id}}/qr-codes", "host": ["{{base_url}}"], "path": ["api","v1","tickets","{{ticket_id}}","qr-codes"] }
          }
        }
      ]
    },
    {
      "name": "Ticket Validations",
      "item": [
        {
          "name": "Validate Ticket (MANUAL)",
          "request": {
            "method": "POST",
            "header": [ { "key": "Content-Type", "value": "application/json" } ],
            "url": { "raw": "{{base_url}}/api/v1/ticket-validations", "host": ["{{base_url}}"], "path": ["api","v1","ticket-validations"] },
            "body": { "mode": "raw", "raw": "{\n  \"id\": \"{{ticket_id}}\",\n  \"method\": \"MANUAL\"\n}" }
          }
        },
        {
          "name": "Validate Ticket (QR_CODE)",
          "request": {
            "method": "POST",
            "header": [ { "key": "Content-Type", "value": "application/json" } ],
            "url": { "raw": "{{base_url}}/api/v1/ticket-validations", "host": ["{{base_url}}"], "path": ["api","v1","ticket-validations"] },
            "body": { "mode": "raw", "raw": "{\n  \"id\": \"{{ticket_id}}\",\n  \"method\": \"QR_CODE\"\n}" }
          }
        }
      ]
    }
  ]
}

